<!--
 * @Description:
 * @Autor: liang
 * @Date: 2020-04-12 10:06:12
 * @LastEditors: liang
 * @LastEditTime: 2020-04-12 22:20:24
 -->

## ç¯å¢ƒ

é…ç½®ï¼šubuntu

## å®‰è£…é…ç½® nginx

- 1.å®‰è£…

```js
sudo apt-get install nginx
```

Ubuntu å®‰è£…ä¹‹åçš„æ–‡ä»¶ç»“æ„å¤§è‡´ä¸ºï¼š

æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åœ¨/etc/nginx ä¸‹ï¼Œå¹¶ä¸”æ¯ä¸ªè™šæ‹Ÿä¸»æœºå·²ç»å®‰æ’åœ¨äº†/etc/nginx/sites-available ä¸‹
ç¨‹åºæ–‡ä»¶åœ¨/usr/sbin/nginx
æ—¥å¿—æ”¾åœ¨äº†/var/log/nginx ä¸­
å¹¶å·²ç»åœ¨/etc/init.d/ä¸‹åˆ›å»ºäº†å¯åŠ¨è„šæœ¬ nginx
é»˜è®¤çš„è™šæ‹Ÿä¸»æœºçš„ç›®å½•è®¾ç½®åœ¨äº†/var/www/nginx-default (æœ‰çš„ç‰ˆæœ¬ é»˜è®¤çš„è™šæ‹Ÿä¸»æœºçš„ç›®å½•è®¾ç½®åœ¨äº†/var/www, è¯·å‚è€ƒ/etc/nginx/sites-available é‡Œçš„é…ç½®)

- 2.å¯åŠ¨

```js
sudo /etc/init.d/nginx start
```

- 3.æŸ¥çœ‹æ˜¯å¦å¯åŠ¨

```js
netstat - lnp;
```

æ‰“å¼€ä½ çš„æœåŠ¡å™¨çš„å…¬ç½‘ IPï¼Œå¦‚æœå‡ºæ¥ä¸€ä¸ª welcome to nginxã€‚ã€‚ã€‚çš„é¡µé¢ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸ

## é…ç½®æ–‡ä»¶ nginx.conf

nginx.confğŸˆ¶ ç”±ä¸‰éƒ¨åˆ†ç»„æˆ

### 1.å…¨å±€å—

ä»é…ç½®æ–‡ä»¶åˆ° events ä¹‹é—´åˆ°å†…å®¹ï¼Œä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œåˆ°é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ nginx æœåŠ¡å™¨åˆ°ç”¨æˆ·ç»„ã€è¿è¡Œç”Ÿæˆçš„ worker process æ•°ï¼Œ è¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å­å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰
å¦‚ï¼š

> worker processes 1;

è¿™æ˜¯ nginx æœåŠ¡å™¨å¹¶å‘å¤„ç†æœåŠ¡åˆ°å…³é”®é…ç½®ï¼Œå€¼è¶Šå¤§ï¼Œå¯ä»¥å¤„ç†çš„å¹¶å‘é‡è¶Šå¤šï¼Œä½†ä¼šå—è½¯ç¡¬ä»¶è®¾å¤‡ä½†åˆ¶çº¦

### 2.events å—

æ¶‰åŠæŒ‡ä»¤ä¸»è¦å½±å“ nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œé“¾æ¥,å¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š work process ä¸‹çš„ç½‘ç»œé“¾æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œé“¾æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†é“¾æ¥è¯·æ±‚ï¼Œæ¯ä¸ª worker process å¯ä»¥åŒæ—¶æ”¯æŒå¯¹æœ€å¤§é“¾æ¥æ•°ç­‰

> worker connections 1024

æ¯ä¸ª worker process æ”¯æŒæœ€å¤§çš„è¿æ¥æ•°ä¸º 1024ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œåº”çµæ´»é…ç½®

### 3. http å—

é…ç½®æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜å’Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œ

> http å—åˆ†ä¸º http å…¨å±€å—å’Œ server å—

- http å…¨å±€å—
  æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIMEâ€”TYPE å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€é“¾æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰

```js
http {
  ...   //å…¨å±€å—å®šä¹‰
  server {

  }
}
```

## ä½¿ç”¨

```js
worker_processes  1;

events {
    worker_connections  1024;
}
http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    #gzip  on;
    server {
      listen 80;
      server_name 118.25.178.83;
      index index.html;
      root /var/www/html/build;    //é™æ€æ–‡ä»¶è·¯å¾„
      try_files $uri $uri/ /index.html;  //ç½‘ç«™æ ¹ç›®å½•
      location /api/ {
        proxy_pass http://localhost:3000/;  //åå‘ä»£ç†
      }
    }
}
```

### pm2 å¯åŠ¨ node

linux ä¸‹è½½ pm2 æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œè‡ªè¡Œç™¾åº¦ï¼Œå¦‚æœéƒ½ä¸è¡Œï¼Œå¯ä»¥è¯•è¯•è¿™ç§æ–¹æ³•

1.é¦–å…ˆåœ¨æœ¬åœ°å…¨å±€å®‰è£… pm2

```js
npm i pm2 -g
```

ç„¶åé€šè¿‡`npm config get prefix`æŸ¥æ‰¾åˆ°å…¨å±€å®‰è£…çš„ pm2ï¼ˆåœ¨...node_modules/ï¼‰ä¸‹ï¼Œç„¶åæŠŠ pm2 æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶å‡ºæ¥ï¼Œæ‰“åŒ…åé€šè¿‡å„ç§æ–¹å¼ä¸Šä¼ åˆ°æœåŠ¡å™¨ 2.é…ç½®ä¸ºå…¨å±€å‘½ä»¤
åœ¨ linux ä¸­ï¼Œé€šè¿‡è½¯è¿æ¥å°† pm2 è®¾ç½®ä¸ºå…¨å±€å‘½ä»¤

```js
sudo ln -s /pm2/bin/pm2 /usr/local/bin/pm2
```

ä¸Šé¢çš„æ˜¯ pm2 ç›®å½•ä¸‹çš„ bin ç›®å½•ä¸‹çš„ä¸€ä¸ª pm2 å¯æ‰§è¡Œæ–‡ä»¶ è½¯è¿æ¥åˆ° /usr/local/bin/pm2
è¿™æ ·ä¹‹åå…¨å±€è¾“å…¥ pm2 å‘½ä»¤éƒ½è¡Œäº†
